<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>AtomicQuantumBot</title>
    <style>
        /* --- Body & Layout --- */
        body {
            font-family: 'Arial', sans-serif;
            background-color: #f0f2f5;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
        }

        .chat-container {
            width: 420px;
            max-width: 95%;
            height: 600px;
            background-color: #fff;
            border-radius: 15px;
            box-shadow: 0 6px 20px rgba(0,0,0,0.2);
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        /* --- Chat Window --- */
        #chat {
            flex: 1;
            padding: 15px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .message-wrapper {
            display: flex;
            align-items: flex-end;
        }

        .message-wrapper.bot {
            justify-content: flex-start;
        }

        .message-wrapper.user {
            justify-content: flex-end;
        }

        .avatar {
            width: 35px;
            height: 35px;
            border-radius: 50%;
            margin: 0 8px;
        }

        .message {
            max-width: 70%;
            padding: 10px 15px;
            border-radius: 20px;
            word-wrap: break-word;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            position: relative;
        }

        .user .message {
            background-color: #4e9af1;
            color: #fff;
            border-bottom-right-radius: 0;
        }

        .bot .message {
            background-color: #e4e6eb;
            color: #333;
            border-bottom-left-radius: 0;
        }

        /* --- Typing animation --- */
        .typing {
            width: 60px;
            height: 10px;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .typing span {
            display: block;
            width: 8px;
            height: 8px;
            background-color: #888;
            border-radius: 50%;
            animation: blink 1.4s infinite both;
        }

        .typing span:nth-child(2) { animation-delay: 0.2s; }
        .typing span:nth-child(3) { animation-delay: 0.4s; }

        @keyframes blink {
            0%, 80%, 100% { opacity: 0; }
            40% { opacity: 1; }
        }

        /* --- Input Area --- */
        .input-area {
            display: flex;
            border-top: 1px solid #ddd;
        }

        #userInput {
            flex: 1;
            padding: 12px 15px;
            border: none;
            outline: none;
            font-size: 16px;
        }

        #sendBtn {
            background-color: #4e9af1;
            border: none;
            color: #fff;
            padding: 0 20px;
            cursor: pointer;
            font-size: 16px;
            transition: background 0.3s;
        }

        #sendBtn:hover {
            background-color: #3a7bd5;
        }

        /* Scrollbar */
        #chat::-webkit-scrollbar {
            width: 6px;
        }

        #chat::-webkit-scrollbar-thumb {
            background-color: rgba(0,0,0,0.2);
            border-radius: 3px;
        }

    </style>
</head>
<body>
    <div class="chat-container">
        <div id="chat"></div>
        <div class="input-area">
            <input type="text" id="userInput" placeholder="Type your message..." />
            <button id="sendBtn">Send</button>
        </div>
    </div>

    <script>
        const apiUrl = "https://vgx43ctmkutvp76ibvrr3blbvu0xrymu.lambda-url.ap-southeast-1.on.aws/"; // Replace with your Lambda URL

        const chat = document.getElementById("chat");
        const input = document.getElementById("userInput");
        const sendBtn = document.getElementById("sendBtn");

        // Add message to chat with optional avatar
        function addMessage(text, sender, isTyping = false) {
            const wrapper = document.createElement("div");
            wrapper.className = `message-wrapper ${sender}`;

            if (sender === "bot") {
                const avatar = document.createElement("img");
                avatar.src = "https://robohash.org/minimanonautem.png?size=50x50&set=set1"; // Example bot avatar
                avatar.alt = "Bot";
                avatar.className = "avatar";
                wrapper.appendChild(avatar);
            }

            const msgDiv = document.createElement("div");
            msgDiv.className = "message";

            if (isTyping) {
                const typingDiv = document.createElement("div");
                typingDiv.className = "typing";
                typingDiv.innerHTML = "<span></span><span></span><span></span>";
                msgDiv.appendChild(typingDiv);
            } else {
                msgDiv.textContent = text;
            }

            wrapper.appendChild(msgDiv);

            if (sender === "user") {
                const avatar = document.createElement("img");
                avatar.src = "https://robohash.org/eosvoluptatesrecusandae.png?size=50x50&set=set1"; // Example user avatar
                avatar.alt = "You";
                avatar.className = "avatar";
                wrapper.appendChild(avatar);
            }

            chat.appendChild(wrapper);
            chat.scrollTop = chat.scrollHeight;
            return msgDiv;
        }

        // Send user message
        async function sendMessage() {
            const msg = input.value.trim();
            if (!msg) return;

            addMessage(msg, "user");
            input.value = "";
            input.disabled = true;
            sendBtn.disabled = true;

            // Show bot typing
            const typingDiv = addMessage("", "bot", true);

            try {
                const response = await fetch(apiUrl, {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ messages: [{ role: "user", content: msg }] })
                });
                const data = await response.json();

                // Replace typing with actual response
                typingDiv.innerHTML = data.reply;

            } catch (err) {
                typingDiv.innerHTML = "Oops! Something went wrong.";
                console.error(err);
            } finally {
                input.disabled = false;
                sendBtn.disabled = false;
                input.focus();
            }
        }

        // Event listeners
        sendBtn.addEventListener("click", sendMessage);
        input.addEventListener("keypress", (e) => {
            if (e.key === "Enter") sendMessage();
        });

        // Initial welcome message
        addMessage("Hello! I'm AtomicQuantumBot. How can I help you today?", "bot");
    </script>
</body>
</html>
